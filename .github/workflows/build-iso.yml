name: Build Bootable ISO

on:
  workflow_dispatch:

jobs:
  iso:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - name: Build bootable ISO
        run: bash installer/scripts/build-iso-linux.sh
      - name: Fix permissions for artifacts
        if: always()
        run: sudo chown -R $USER:$USER installer/live/work || true
      - name: Upload ISO artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows12-style-os-iso
          path: installer/live/work/live-image-amd64.hybrid.iso
      - name: Upload build logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: windows12-style-os-iso-logs
          path: |
            installer/live/work/*.log
            installer/live/work/config
